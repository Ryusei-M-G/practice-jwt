# JsonWebTokenを使用した認証機能の練習
認証の流れを把握するために学習用として作成しました。
練習用のためDB接続のコードやキーなどはハードコードしています。
## 機能について
### 1. 登録
#### エンドポイント `/register`
- request bodyのデータをサーバーでチェックしDBに登録します。この際にbcryptでパスワードをハッシュ化して保存します
### 2. ログイン
#### エンドポイント `/login`
- request bodyのデータをDBのデータと照合して、一致していればトークンを返します。
- JSONレスポンスに期限15分のアクセストークンを返し、Cookieに期限7日のリフレッシュトークンを返します。
### 3. 認証が必要なプロフィール情報
#### エンドポイント `/profile`
- アクセストークンに含まれるユーザー情報に基づいたプロフィール情報を返します。
- アクセストークンの期限が切れていれば、リフレッシュトークンを認証してから新規でアクセストークンを発行します。
- アクセストークンの再発行後はリフレッシュトークンも再発行し新しいリフレッシュトークンを返します。
### 4. ログアウト
#### エンドポイント `/logout`
- トークンを使用不可にします。

## データベース設計

### テーブル関係

**users** ──(1:1)── **profile**

- usersテーブルとprofileテーブルは1対1の関係
- profile.user_id が users.id を参照する外部キー

### テーブル定義

#### users テーブル
- `id` (serial4) - Primary Key
- `email` (varchar(255)) - メールアドレス
- `username` (varchar(100)) - ユーザー名
- `password` (varchar(255)) - ハッシュ化されたパスワード
- `create_at` (timestamp) - 作成日時

#### profile テーブル
- `user_id` (int4) - Primary Key, Foreign Key (users.id)
- `text1` (text) - プロフィール情報1
- `text2` (text) - プロフィール情報2
